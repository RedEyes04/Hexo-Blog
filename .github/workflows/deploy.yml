name: Deploy Hexo Blog

on:
  push:
    branches:
      - main
    paths:
      - 'source/_posts/**'
  delete:
    branches:
      - main
    paths:
      - 'source/_posts/**'

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Install sshpass
        run: sudo apt-get install -y sshpass

      - name: Copy files to server using rsync
        run: |
          sshpass -p "${{ secrets.SERVER_PASSWORD }}" rsync -avz --progress -e "ssh -o StrictHostKeyChecking=no" ./source/_posts/ root@${{ secrets.SERVER_HOST }}:/blog/source/_posts/

      - name: Run hexo commands on server
        run: |
          sshpass -p "${{ secrets.SERVER_PASSWORD }}" ssh -o StrictHostKeyChecking=no root@${{ secrets.SERVER_HOST }} "cd /blog && hexo g && hexo d"
