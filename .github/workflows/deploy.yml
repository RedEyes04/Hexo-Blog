name: Deploy Hexo Blog

on:
  push:
    branches:
      - main  # 监听推送到 main 分支的操作
    paths:
      - 'source/_posts/**'  # 只在 source/_posts 下的文件变化时触发

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    # 检出仓库的最新版本
    - name: Checkout repository
      uses: actions/checkout@v3

    # 使用 SSH 连接到你的服务器
    - name: Copy files to server
      uses: appleboy/scp-action@v0.1.6
      with:
        host: ${{ secrets.SERVER_HOST }}  # 从 GitHub Secrets 中获取服务器地址
        username: ${{ secrets.SERVER_USER }}  # 从 GitHub Secrets 中获取用户名
        key: ${{ secrets.SERVER_SSH_KEY }}  # 从 GitHub Secrets 中获取 SSH 私钥
        source: "source/_posts/*"  # 只同步 _posts 目录下的文件
        target: "/blog/source/_posts"  # 服务器上对应的 _posts 目录路径

    # 在服务器上执行 Hexo 相关命令
    - name: Run hexo commands on server
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SERVER_HOST }}
        username: ${{ secrets.SERVER_USER }}
        key: ${{ secrets.SERVER_SSH_KEY }}
        script: |
          cd /path/to/your/blog  # 进入服务器上的 Hexo 目录
          hexo g  # 生成静态文件
          hexo d  # 部署博客
